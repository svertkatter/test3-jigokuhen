<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0 user-scalable=no, viewport-fit=cover">
    <title>地獄變</title>
    <link rel="stylesheet" href="reset.css">
    <link rel="stylesheet" href="style.css">
    <script>
        (function (d) {
            var config = {
                kitId: 'nfn3pcb',
                scriptTimeout: 3000,
                async: true
            },
                h = d.documentElement, t = setTimeout(function () { h.className = h.className.replace(/\bwf-loading\b/g, "") + " wf-inactive"; }, config.scriptTimeout), tk = d.createElement("script"), f = false, s = d.getElementsByTagName("script")[0], a; h.className += " wf-loading"; tk.src = 'https://use.typekit.net/' + config.kitId + '.js'; tk.async = true; tk.onload = tk.onreadystatechange = function () { a = this.readyState; if (f || a && a != "complete" && a != "loaded") return; f = true; clearTimeout(t); try { Typekit.load(config) } catch (e) { } }; s.parentNode.insertBefore(tk, s)
        })(document);
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.4/gsap.min.js"></script>
</head>

<body>
    <div id="main" class="fullPageScroll">
        <section id="section1" class="section section1">
            <p class="title">地獄變</p>
            <div class="txt-box">
                <p>それはある画師が描いた屏風絵。</p>
                <p>この屏風絵にはある逸話がある。</p>
            </div>
        </section>
        <section id="section2" class="section section2">
            <div class="txt-box">
                <p>あなたは高名な画師です。</p>
                <p>あなたの右に出る者は誰もいません。</p>
                <p>その噂を聞きつけたのか、とある殿様が<br>たびたびあなたに画の依頼をしてきました。</p>
            </div>
        </section>
        <section id="section3" class="section section3">
            <div class="txt-box">
                <p>あなたと殿様には因縁があります。</p>
                <p>この殿様の元では、あなたの最愛の娘が働いていました。</p>
                <p>あなたはそんな娘の身を案じ、ある画の依頼には、<br>褒美として娘を御前から下げて欲しい<br>とお願いしたこともあります。</p>
            </div>
        </section>
        <section id="section4" class="section section4">
            <div class="txt-box">
                <p>それほど大事な娘でした。</p>
            </div>
        </section>
        <section id="section5" class="section section5">
            <div class="txt-box">
                <p>そんなある日のこと。</p>
                <p>殿様から地獄の様子を表した、地獄變の屏風を描け、<br>という命令がありました。</p>
                <p>あなたはそれを了承します。</p>
                <p>殿様の命は断れません。</p>
            </div>
        </section>
        <section id="section6" class="section section6">
            <div class="txt-box">
                <p>しかし、あなたは見たものしか画を描くことが出来ない画師でした。</p>
            </div>
        </section>
        <section id="section7" class="section section7">
            <div class="txt-box">
                <p>そのため、地獄の様子を描くために、<br>弟子の一人には鎖で縛り上げ、悶え苦しむ亡者を描きました。</p>
                <p>ある一人にはミミズクを追い回させ責め苦を与え、<br>怪鳥に襲われる様子を描きました。</p>
                <p>このようにして、あなたは地獄の様子を鮮明に描きました。</p>
            </div>
        </section>
        <section id="section8" class="section section8">
            <div class="txt-box">
                <p>そして最後の大目玉を描こうとしたときでした。</p>
                <p>炎に包まれ空から落ちる檳榔毛の牛車の画。</p>
                <p>それを描こうと考えていましたがなかなか描けませんでした。</p>
            </div>
        </section>
        <section id="section9" class="section section9">
            <div class="txt-box">
                <p>「空から落ちる檳榔毛の牛車。その牛車の中には一人のあでやかな上臈が、<br>猛火の中に黒髪を見いだしながら悶え苦しんでいる様。<br>顔は煙にむせびながら、眉をひそめて、空を仰いでいる。<br>手は簾を引きちぎって、降りかかる火の粉を防いでいるかもしれない。
                </p>
            </div>
        </section>
        <section id="section10" class="section section10">
            <div class="txt-box">
                <p>そうしてその周りには怪鳥が十羽となく、<br>二十羽となく、嘴を鳴らして粉々と飛びめぐっている。
                    <br>　しかし、それが、その牛車の中の上臈が、私にはどうしても描けないのです。」
                </p>
            </div>
        </section>
        <section id="section11" class="section section11">
            <div class="txt-box">
                <p>あなたはその画を描くために、殿様に直接お願いしようと考えました。</p>
                <p>しかし、それだけでは駄目だと気付いていました。<br>直接お願いし、牛車を燃やしてしまうだけでは、最後の画を描けないと、<br>足りないと、あなたは本能的に感じていました。</p>
            </div>
        </section>
        <section id="section12" class="section section12">
            <div class="txt-box">
                <p>何か犠牲が必要だと。</p>
            </div>
        </section>
        <section id="section13" class="section section13">
            <div class="txt-box">
                <p>あなたは殿様に事情を話し、檳榔毛の牛車を実際に燃やして欲しいと頼みました。</p>
                <p>「そうして出来るならば……」
                </p>
            </div>
        </section>
        <section id="section14" class="section section14">
            <div class="txt-box">
                <p>殿様はすっと顔を暗くしたかと思うと、あなたの頼みを快諾しました。</p>
            </div>
        </section>
        <section id="section15" class="section section15">
            <div class="txt-box">
                <p>「では、檳榔毛の牛車を一両用意しよう。そしてそれに火をかけよう。<br>中には艶やかな、上臈の装いをさせて乗せて遣わそう。<br>炎と黒煙とに攻められて、牛車の中の女が悶え死をする……<br>それを描こうと思いついたのは、流石天下第一の画師じゃ」
                </p>
            </div>
        </section>
        <section id="section16" class="section section16">
            <div class="txt-box">
                <p>……</p>
            </div>
        </section>

        <section id="section17" class="section section17">
            <div class="txt-box">
                <p>あなたは殿様に……</p>
            </div>
        </section>

        <section id="section18" class="section section18">
            <div class="txt-box">
                <p>「そうして出来るならば……</p>
                <button id="permissionButton">あなたの家臣を一人、牛車にお乗せください。」
                </button>
                <button id="resetButton">私の娘を、どうぞ牛車にお乗せください。」</button>
            </div>
            <div class="back">
                <div class="mssg">
                    <p>スマホを筆のように、屏風の前で振ってください。</p>
                </div>
            </div>
        </section>
    </div>
    <script>
        let ws = new WebSocket('wss://our-socket-server.onrender.com:443');
        let selectValue = 2;

        //gsap
        const tl = gsap.timeline({ paused: true });

        tl.fromTo(
            //メニューを上から下へ表示
            ".back",
            {
                autoAlpha: 0,
            },
            {
                autoAlpha: 1,
                top: 0,
                duration: 1,
                ease: Power2.easeInOut,
            }

        ).fromTo(
            ".mssg", {
            autoAlpha: 0,
        },
            {
                autoAlpha: 1,
                duration: 2,
                ease: Power2.easeInOut,
            }
        );

        function sendAccelerationData(acceleration) {
            const dataToSend = {
                x: acceleration.x,
                y: acceleration.y,
                z: acceleration.z,
                select: selectValue
            };
            ws.send(JSON.stringify(dataToSend));
        }

        function setupDeviceMotion() {
            window.addEventListener('devicemotion', (event) => {
                const acceleration = {
                    x: event.acceleration.x,
                    y: event.acceleration.y,
                    z: event.acceleration.z
                };
                sendAccelerationData(acceleration);
            });
        }

        function requestPermission() {
            if (typeof DeviceMotionEvent.requestPermission === 'function') {
                DeviceMotionEvent.requestPermission()
                    .then(permissionState => {
                        if (permissionState === 'granted') {
                            setupDeviceMotion();
                        } else {
                            alert('加速度センサーへのアクセスが許可されていません。');
                        }
                    })
                    .catch(console.error);
            } else {
                setupDeviceMotion();
            }
        }

        document.getElementById('permissionButton').addEventListener('click', function () {
            tl.play();
            selectValue = 1;
            requestPermission();
        });

        document.getElementById('resetButton').addEventListener('click', function () {
            tl.play();
            selectValue = 0;
            requestPermission();
        });

        // スムーススクロール
        const paginations = document.querySelectorAll(".pagination a");
        paginations.forEach(pagination => {
            pagination.addEventListener("click", e => {
                e.preventDefault();
                const targetId = e.target.hash;
                const target = document.querySelector(targetId);
                target.scrollIntoView({ behavior: "smooth" });
            });
        });

        // Intersection Observer
        const sections = document.querySelectorAll(".section");
        const observerRoot = document.querySelector(".fullPageScroll");
        const options = {
            root: observerRoot,
            rootMargin: "-50% 0px",
            threshold: 0
        };
        const observer = new IntersectionObserver(doWhenIntersect, options);
        sections.forEach(section => {
            observer.observe(section);
        });

        function doWhenIntersect(entries) {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    activatePagination(entry.target);
                }
            });
        }
    </script>
</body>

</html>